const board=document.getElementById('board');const winningMessage=document.getElementById('winning-message');const winningText=document.querySelector('.winning-text');const startButton=document.getElementById('start-btn');const playWithComputerButton=document.getElementById('play-with-computer-btn');const restartButton=document.getElementById('restart-btn');const playAgainButton=document.getElementById('play-again-btn');const score1Element=document.getElementById('score-1');const score2Element=document.getElementById('score-2');const turnInfo=document.getElementById('turn-info');const player1NameInput=document.getElementById('player1Name');const player2NameInput=document.getElementById('player2Name');const avatarSelectors=document.querySelectorAll('.avatar-selector');const avatarOptions=document.querySelectorAll('.avatar-options');const thinkingIndicator=document.getElementById('thinking-indicator');const winSounds=[new Audio('sounds/th·∫Øng r·ªìi yahoo.mp3'),new Audio('sounds/th·∫Øng r·ªìi nha.mp3'),new Audio('sounds/nanana.mp3'),new Audio('sounds/ƒë√πa v·ªõi ninja r√πa √†.mp3'),new Audio('sounds/hihi_dua_voi_n·ªãna_rua_a.mp3'),new Audio('sounds/ƒë√°nh th·∫ø kh√¥ng th·∫Øng ƒë∆∞·ª£c ƒë√¢u b·∫°n ∆°i.mp3'),new Audio('sounds/h√°t lalala.mp3'),new Audio('sounds/n√†y th√¨ ƒë√°nh n√†y hihihi.mp3'),new Audio('sounds/thua_di_ban_oi_hihi.mp3'),new Audio('sounds/thang_hoai_the_nay_thi_chan_nhe.mp3'),new Audio('sounds/co_thang_duoc_dau_ma_danh_the.mp3'),new Audio('sounds/cuoi.mp3'),new Audio('sounds/eo_oi_ghe_nho.mp3'),new Audio('sounds/danh_buon_cuoi_the.mp3'),];const loseAudios=[new Audio('sounds/bu·ªìn nh∆∞ con chu·ªìn chu·ªìn.mp3'),new Audio('sounds/ch√°n nh∆∞ con gi√°n lu√¥n.mp3'),new Audio('sounds/ch√°n th·∫ø nh·ªù 2.mp3'),new Audio('sounds/ch√°n th·∫ø nh·ªù.mp3'),new Audio('sounds/thua m·∫•t r·ªìi tr·ªùi ∆°i.mp3'),new Audio('sounds/thua r·ªìi ch√°n th·∫ø nh·ªü.mp3'),new Audio('sounds/ghe_qua.mp3')];const moveSounds=[new Audio('sounds/ƒë√°nh n√†y.mp3'),new Audio('sounds/ƒë√°nh n√†y_2.mp3'),new Audio('sounds/ƒë·∫øn l∆∞·ª£t b·∫°n r·ªìi.mp3'),new Audio('sounds/ƒë·∫øn l∆∞·ª£t b·∫°n r·ªìi_2.mp3'),new Audio('sounds/ƒë√°nh n√†y.mp3'),new Audio('sounds/ƒë√°nh n√†y_2.mp3'),new Audio('sounds/ƒë√°nh n√†y.mp3'),new Audio('sounds/ƒë√°nh v√†o ch·ªó n√†y.mp3'),new Audio('sounds/ƒë√°nh ƒë√™ b·∫°n ∆°i.mp3'),new Audio('sounds/ƒë·ª° v√†o m·∫Øt nh√©.mp3'),new Audio('sounds/ch∆°i h·∫øt m√¨nh ƒëi b·∫°n ∆°i.mp3'),new Audio('sounds/ƒë√°nh n√†y.mp3'),new Audio('sounds/ƒë√°nh n√†y_2.mp3'),new Audio('sounds/ƒë·∫øn l∆∞·ª£t b·∫°n r·ªìi.mp3'),new Audio('sounds/ƒë·∫øn l∆∞·ª£t b·∫°n r·ªìi_2.mp3'),new Audio('sounds/ƒë·ªë b·∫°n th·∫Øng ƒë∆∞·ª£c t√¥i ƒë·∫•y.mp3'),new Audio('sounds/uhm c·ª© ƒë√°nh v√†o ƒë√¢y ƒë√£.mp3'),new Audio('sounds/n√†y th√¨ ƒë√°nh n√†y hihihi.mp3'),new Audio('sounds/bu·ªìn ng·ªß th·∫ø nh·ªù.mp3'),new Audio('sounds/√† ƒë√°nh n√†y.mp3'),new Audio('sounds/uhm c·ª© ƒë√°nh v√†o ƒë√¢y ƒë√£.mp3'),];let scores={player1:0,player2:0};let isPlayer1Turn=!0;let gameActive=!1;let lastWinner=null;let isComputerMode=!1;let lastHumanMove=null;let isFirstGame=!0;let cells;let isSoundEnabled=localStorage.getItem('isSoundEnabled')!=='false';let computerDifficulty=localStorage.getItem('computerDifficulty')||'5';const congratMessages=["üéâ Xu·∫•t s·∫Øc! B·∫°n ƒë√£ chi·∫øn th·∫Øng ƒë·∫ßy thuy·∫øt ph·ª•c!","üåü Wow! ƒê√∫ng l√† b·∫≠c th·∫ßy c·ªù ca-r√¥!","üèÜ Chi·∫øn th·∫Øng tuy·ªát v·ªùi! ƒê·ªëi th·ªß kh√¥ng c√≥ c·ª≠a!","üëë Qu√° ƒë·ªânh! X·ª©ng ƒë√°ng l√† nh√† v√¥ ƒë·ªãch!","üéÆ Game hay qu√°! Th·∫Øng ƒë·∫πp nh∆∞ phim!","‚≠ê ƒê·∫≥ng c·∫•p! Kh√¥ng ai c·∫£n ƒë∆∞·ª£c b·∫°n!","üéØ Ch√≠nh x√°c t·ª´ng n∆∞·ªõc ƒëi! Qu√° xu·∫•t s·∫Øc!","üåà Tuy·ªát v·ªùi √¥ng m·∫∑t tr·ªùi! Th·∫Øng qu√° x·ª©ng ƒë√°ng!","üí´ Si√™u sao c·ªù ca-r√¥ ƒë√¢y r·ªìi!","üî• Qu√° hot! ƒê·ªëi th·ªß ph·∫£i ch√†o thua!","üåà Tuy·ªát v·ªùi √¥ng m·∫∑t tr·ªùi!","üé™ Xinh ƒë·∫πp t√†i gi·ªèi l·∫°i c√≤n gi·ªèi c·ªù ca-r√¥ n·ªØa!","üé≠ Th√¥ng minh qu√°! ƒê√°nh hay nh∆∞ di·ªÖn vi√™n ch√≠nh v·∫≠y!","üé® Ngh·ªá sƒ© c·ªßa tr√≤ ch∆°i ƒë√¢y r·ªìi!","üé™ D·ªÖ th∆∞∆°ng m√† c√≤n gi·ªèi th·∫ø n√†y!","üé≠ Th·∫Øng ƒë·∫πp nh∆∞ m·ªôt v·ªü k·ªãch hay!","üé™ T√†i nƒÉng xu·∫•t ch√∫ng! Ai c≈©ng ph·∫£i n·ªÉ ph·ª•c!","üé≠ Qu√° ƒë√°ng y√™u! V·ª´a xinh v·ª´a gi·ªèi!","üé® Ngh·ªá thu·∫≠t ƒë√°nh c·ªù c·ªßa b·∫°n th·∫≠t tuy·ªát v·ªùi!","üé™ D·ªÖ th∆∞∆°ng h·∫øt ph·∫ßn thi√™n h·∫°!","üé≠ Th·∫Øng ƒë·∫πp nh∆∞ m·ªôt v·ªü di·ªÖn ho√†n h·∫£o!"];function getRandomCongratMessage(){const randomIndex=Math.floor(Math.random()*congratMessages.length);return congratMessages[randomIndex]}
avatarSelectors.forEach(selector=>{selector.addEventListener('click',(e)=>{const options=selector.querySelector('.avatar-options');options.classList.toggle('show');const closeHandler=(event)=>{if(!event.target.closest('.avatar-selector')){options.classList.remove('show');document.removeEventListener('click',closeHandler)}};setTimeout(()=>{document.addEventListener('click',closeHandler)},0)})});avatarOptions.forEach(options=>{options.querySelectorAll('i').forEach(icon=>{icon.addEventListener('click',(e)=>{e.stopPropagation();const avatar=e.target.dataset.avatar;const currentAvatar=options.closest('.avatar-selector').querySelector('.current-avatar');currentAvatar.className=`current-avatar fa-solid ${avatar} fa-6x`;options.classList.remove('show');const playerNumber=options.id==='avatarOptions1'?1:2;if(!isComputerMode||playerNumber===2){const playerName=playerNumber===1?player1NameInput.value:player2NameInput.value;savePlayerInfo(playerNumber,playerName,avatar);updateGameAreaAvatars()}})})});const WINNING_COMBINATIONS=[];for(let i=0;i<10;i++){const row=[];for(let j=0;j<6;j++){row.push([i*10+j,i*10+j+1,i*10+j+2,i*10+j+3,i*10+j+4])}
WINNING_COMBINATIONS.push(...row)}
for(let i=0;i<10;i++){const col=[];for(let j=0;j<6;j++){col.push([i+j*10,i+(j+1)*10,i+(j+2)*10,i+(j+3)*10,i+(j+4)*10])}
WINNING_COMBINATIONS.push(...col)}
for(let i=0;i<6;i++){for(let j=0;j<6;j++){if(j+4<10&&i+4<10){WINNING_COMBINATIONS.push([i*10+j,(i+1)*10+(j+1),(i+2)*10+(j+2),(i+3)*10+(j+3),(i+4)*10+(j+4)])}
if(j+4<10&&i+4<10){WINNING_COMBINATIONS.push([i*10+(j+4),(i+1)*10+(j+3),(i+2)*10+(j+2),(i+3)*10+(j+1),(i+4)*10+j])}}}
const STORAGE_KEYS={DIFFICULTY:'ticTacToe_difficulty',PLAYER1_NAME:'ticTacToe_player1Name',PLAYER2_NAME:'ticTacToe_player2Name'};function getPlayerName(playerNumber){const input=playerNumber===1?player1NameInput:player2NameInput;return input.value.trim()||`Ng∆∞·ªùi ch∆°i ${playerNumber}`}
function updateTurnInfo(){const currentPlayerName=isPlayer1Turn?getPlayerName(1):getPlayerName(2);const symbol=isPlayer1Turn?'X':'O';turnInfo.textContent=`L∆∞·ª£t c·ªßa ${currentPlayerName} (${symbol})`;const player1Element=document.querySelector('.player-1');const player2Element=document.querySelector('.player-2');const player1Avatar=player1Element.querySelector('.current-avatar');const player2Avatar=player2Element.querySelector('.current-avatar');if(isPlayer1Turn){player1Element.classList.add('current-turn');player2Element.classList.remove('current-turn');player1Avatar.classList.add('active');player2Avatar.classList.remove('active')}else{player1Element.classList.remove('current-turn');player2Element.classList.add('current-turn');player1Avatar.classList.remove('active');player2Avatar.classList.add('active')}}
function activatePlayerAvatar(playerNumber){const player1Avatar=document.querySelector('.player-1 .current-avatar');const player2Avatar=document.querySelector('.player-2 .current-avatar');player1Avatar.classList.remove('active');player2Avatar.classList.remove('active');if(playerNumber===1){player1Avatar.classList.add('active')}else if(playerNumber===2){player2Avatar.classList.add('active')}
setTimeout(()=>{player1Avatar.classList.remove('active');player2Avatar.classList.remove('active')},15000)}
function startGame(withComputer=!1){cells.forEach(cell=>{cell.classList.remove('winning');cell.classList.remove('last-move');cell.innerHTML='';cell.classList.remove('x','o');cell.textContent=''});winningMessage.classList.remove('show');startButton.classList.remove('remind');playWithComputerButton.classList.remove('remind');isComputerMode=withComputer;startButton.style.display='none';playWithComputerButton.style.display='none';const difficultySelect=document.querySelector('.difficulty-select');const restartBtn=document.getElementById('restart-btn');const soundToggle=document.getElementById('sound-toggle');if(withComputer){player1NameInput.disabled=!0;if(difficultySelect){difficultySelect.classList.add('show');const selectElement=difficultySelect.querySelector('select');if(selectElement){selectElement.className='computer-player'}}
const computerInfo=getComputerInfoByDifficulty(computerDifficulty);player1NameInput.value=computerInfo.name;document.querySelector('.player-1 .current-avatar').className=`current-avatar fa-solid ${computerInfo.avatar} fa-6x`;document.querySelector('.player-1 .avatar-selector').style.pointerEvents='none';restartBtn.classList.add('show');soundToggle.classList.add('show');const controlsContainer=document.querySelector('.game-controls');if(controlsContainer){controlsContainer.style.justifyContent='space-between'}}else{loadPlayerInfo();player1NameInput.disabled=!1;if(difficultySelect){difficultySelect.classList.remove('show');const selectElement=difficultySelect.querySelector('select');if(selectElement){selectElement.className=''}}
document.querySelector('.player-1 .current-avatar').className='current-avatar fa-solid fa-cat fa-6x';document.querySelector('.player-1 .avatar-selector').style.pointerEvents='auto';restartBtn.classList.add('show');soundToggle.classList.remove('show');const controlsContainer=document.querySelector('.game-controls');if(controlsContainer){controlsContainer.style.justifyContent='center'}}
updateGameAreaAvatars();if(!player2NameInput.value.trim()){alert('Vui l√≤ng nh·∫≠p t√™n ng∆∞·ªùi ch∆°i!');return}
if(isFirstGame){isPlayer1Turn=withComputer}else{if(lastWinner==='player1'){isPlayer1Turn=!0}else if(lastWinner==='player2'){isPlayer1Turn=!1}else{isPlayer1Turn=!0}}
lastHumanMove=null;gameActive=!0;cells.forEach(cell=>{cell.removeEventListener('click',handleClick);cell.addEventListener('click',handleClick)});updateTurnInfo();if(withComputer&&isPlayer1Turn){setTimeout(computerPlay,isFirstGame?0:500)}}
function handleClick(e){if(!gameActive){if(startButton.style.display!=='none'){startButton.classList.add('remind');playWithComputerButton.classList.add('remind')}
return}
if(isComputerMode&&isPlayer1Turn)return;const cell=e.target;if(cell.classList.contains('x')||cell.classList.contains('o'))return;cell.removeEventListener('click',handleClick);handleCellClick(cell)}
function handleCellClick(cell){const currentClass=isPlayer1Turn?'x':'o';const penIcon=document.createElement('i');penIcon.className=`fa-solid fa-pen pen-pointer ${isPlayer1Turn ? 'player1' : 'player2'}`;const rect=cell.getBoundingClientRect();const boardRect=board.getBoundingClientRect();penIcon.style.left=(rect.left-boardRect.left+rect.width/2-5)+'px';penIcon.style.top=(rect.top-boardRect.top+rect.height/2-30)+'px';board.appendChild(penIcon);setTimeout(()=>{penIcon.remove()},1200);placeMark(cell,currentClass);if(checkWin(currentClass)){endGame(!1)}else if(isDraw()){endGame(!0)}else{swapTurns();updateTurnInfo();if(isComputerMode&&!isPlayer1Turn){lastHumanMove=cell}
if(isComputerMode&&isPlayer1Turn){computerPlay()}}}
function placeMark(cell,currentClass){cells.forEach(c=>c.classList.remove('last-move'));cell.classList.add(currentClass);if(!cell.classList.contains('winning')){cell.textContent=currentClass.toUpperCase()}
cell.classList.add('last-move')}
function swapTurns(){isPlayer1Turn=!isPlayer1Turn}
function checkWin(currentClass){let hasWon=!1;let winningCombination=null;for(let row=0;row<10;row++){for(let col=0;col<=5;col++){let win=!0;for(let i=0;i<5;i++){if(!cells[row*10+col+i].classList.contains(currentClass)){win=!1;break}}
if(win){hasWon=!0;winningCombination=Array.from({length:5},(_,i)=>row*10+col+i);break}}
if(hasWon)break}
if(!hasWon){for(let col=0;col<10;col++){for(let row=0;row<=5;row++){let win=!0;for(let i=0;i<5;i++){if(!cells[(row+i)*10+col].classList.contains(currentClass)){win=!1;break}}
if(win){hasWon=!0;winningCombination=Array.from({length:5},(_,i)=>(row+i)*10+col);break}}
if(hasWon)break}}
if(!hasWon){for(let row=0;row<=5;row++){for(let col=0;col<=5;col++){let win=!0;for(let i=0;i<5;i++){if(!cells[(row+i)*10+col+i].classList.contains(currentClass)){win=!1;break}}
if(win){hasWon=!0;winningCombination=Array.from({length:5},(_,i)=>(row+i)*10+col+i);break}}
if(hasWon)break}}
if(!hasWon){for(let row=0;row<=5;row++){for(let col=4;col<10;col++){let win=!0;for(let i=0;i<5;i++){if(!cells[(row+i)*10+col-i].classList.contains(currentClass)){win=!1;break}}
if(win){hasWon=!0;winningCombination=Array.from({length:5},(_,i)=>(row+i)*10+col-i);break}}
if(hasWon)break}}
if(hasWon&&winningCombination){winningCombination.forEach(index=>{const cell=cells[index];cell.classList.add('winning');cell.innerHTML='<i class="fa-solid fa-face-laugh-wink"></i>'})}
return hasWon}
function isDraw(){return[...cells].every(cell=>{return cell.classList.contains('x')||cell.classList.contains('o')})}
function createConfetti(){const colors=['#ff6b6b','#4d96ff','#ffd868'];confetti({particleCount:100,spread:70,origin:{y:0.6},colors:colors,disableForReducedMotion:!0})}
function playConfettiEffect(){createConfetti();setTimeout(createConfetti,500);setTimeout(createConfetti,1000)}
function endGame(draw){gameActive=!1;if(draw){winningText.innerText='H√≤a r·ªìi! ü§ù';lastWinner=null;winningMessage.classList.add('show')}else{const winner=isPlayer1Turn?getPlayerName(1):getPlayerName(2);const winnerAvatar=isPlayer1Turn?document.querySelector('.player-1 .current-avatar').className.split(' ')[2]:document.querySelector('.player-2 .current-avatar').className.split(' ')[2];const congratMessage=getRandomCongratMessage();playConfettiEffect();if(isComputerMode){if(isPlayer1Turn){playWinSound()}else{playLoseSound()}}
setTimeout(()=>{winningText.innerHTML=`
                <i class="fa-solid ${winnerAvatar} fa-2x"></i><br>
                ${winner} ƒë√£ chi·∫øn th·∫Øng!<br>
                ${congratMessage}
            `;winningMessage.classList.add('show');if(isPlayer1Turn){scores.player1++;score1Element.textContent=scores.player1;lastWinner='player1'}else{scores.player2++;score2Element.textContent=scores.player2;lastWinner='player2'}},3000)}}
function restartGame(){startButton.style.display='block';playWithComputerButton.style.display='block';const difficultySelect=document.querySelector('.difficulty-select');const restartBtn=document.getElementById('restart-btn');const soundToggle=document.getElementById('sound-toggle');difficultySelect.classList.remove('show');restartBtn.classList.remove('show');soundToggle.classList.remove('show');gameActive=!1;isFirstGame=!0;const savedPlayer1Name=localStorage.getItem('player1Name')||"M√©o";const savedPlayer1Avatar=localStorage.getItem('player1Avatar')||"fa-cat";player1NameInput.disabled=!1;player1NameInput.value=savedPlayer1Name;document.querySelector('.player-1 .current-avatar').className=`current-avatar fa-solid ${savedPlayer1Avatar} fa-6x`;document.querySelector('.player-1 .avatar-selector').style.pointerEvents='auto';isComputerMode=!1;updateGameAreaAvatars();cells.forEach(cell=>{cell.classList.remove('x','o','winning','last-move');cell.textContent='';cell.innerHTML='';cell.removeEventListener('click',handleClick);cell.addEventListener('click',handleClick)});winningMessage.classList.remove('show');turnInfo.textContent='L∆∞·ª£t c·ªßa: M√©o (X)';isPlayer1Turn=!0;const player1Element=document.querySelector('.player-1');const player2Element=document.querySelector('.player-2');const player1Avatar=player1Element.querySelector('.current-avatar');const player2Avatar=player2Element.querySelector('.current-avatar');player1Element.classList.add('current-turn');player2Element.classList.remove('current-turn');player1Avatar.classList.remove('active');player2Avatar.classList.remove('active')}
function playAgain(){isFirstGame=!1;startGame(isComputerMode);updateGameAreaAvatars()}
startButton.addEventListener('click',()=>startGame(!1));playWithComputerButton.addEventListener('click',()=>{const currentDifficulty=document.getElementById('difficulty').value;const currentAvatarName=player1NameInput.value;const selectedDifficultyText=document.getElementById('difficulty').options[document.getElementById('difficulty').selectedIndex].text;console.log('=== Th√¥ng tin ch·∫ø ƒë·ªô ch∆°i v·ªõi m√°y ===');console.log('ƒê·ªô kh√≥ ƒëang ch·ªçn:',currentDifficulty);console.log('T√™n hi·ªÉn th·ªã ·ªü avatar:',currentAvatarName);console.log('Text hi·ªÉn th·ªã ·ªü listbox ƒë·ªô kh√≥:',selectedDifficultyText);console.log('=====================================');startGame(!0)});restartButton.addEventListener('click',restartGame);playAgainButton.addEventListener('click',playAgain);player1NameInput.addEventListener('change',function(){if(!isComputerMode){savePlayerInfo(1,this.value,document.querySelector('.player-1 .current-avatar').className.split(' ')[2])}
updateTurnInfo()});player2NameInput.addEventListener('change',function(){savePlayerInfo(2,this.value,document.querySelector('.player-2 .current-avatar').className.split(' ')[2]);updateTurnInfo()});function checkFourInARow(currentClass){for(let row=0;row<10;row++){for(let col=0;col<=5;col++){let count=0;let emptyCell=null;for(let i=0;i<5;i++){const index=row*10+col+i;if(index>=100)continue;const cell=cells[index];if(!cell)continue;if(cell.classList.contains(currentClass)){count++}else if(!cell.classList.contains('x')&&!cell.classList.contains('o')){emptyCell=cell}}
if(count===4&&emptyCell){return emptyCell}}}
for(let col=0;col<10;col++){for(let row=0;row<=5;row++){let count=0;let emptyCell=null;for(let i=0;i<5;i++){const index=(row+i)*10+col;if(index>=100)continue;const cell=cells[index];if(!cell)continue;if(cell.classList.contains(currentClass)){count++}else if(!cell.classList.contains('x')&&!cell.classList.contains('o')){emptyCell=cell}}
if(count===4&&emptyCell){return emptyCell}}}
for(let row=0;row<=5;row++){for(let col=0;col<=5;col++){let count=0;let emptyCell=null;for(let i=0;i<5;i++){const index=(row+i)*10+col+i;if(index>=100)continue;const cell=cells[index];if(!cell)continue;if(cell.classList.contains(currentClass)){count++}else if(!cell.classList.contains('x')&&!cell.classList.contains('o')){emptyCell=cell}}
if(count===4&&emptyCell){return emptyCell}}}
for(let row=0;row<=5;row++){for(let col=4;col<10;col++){let count=0;let emptyCell=null;for(let i=0;i<5;i++){const index=(row+i)*10+col-i;if(index>=100)continue;const cell=cells[index];if(!cell)continue;if(cell.classList.contains(currentClass)){count++}else if(!cell.classList.contains('x')&&!cell.classList.contains('o')){emptyCell=cell}}
if(count===4&&emptyCell){return emptyCell}}}
return null}
function getAdjacentEmptyCells(cellIndex){const row=Math.floor(cellIndex/10);const col=cellIndex%10;const emptyCells=[];for(let i=-1;i<=1;i++){for(let j=-1;j<=1;j++){const newRow=row+i;const newCol=col+j;if(newRow>=0&&newRow<10&&newCol>=0&&newCol<10){const index=newRow*10+newCol;const cell=cells[index];if(!cell.classList.contains('x')&&!cell.classList.contains('o')){emptyCells.push(cell)}}}}
return emptyCells}
function getRandomCell(cellList){return cellList[Math.floor(Math.random()*cellList.length)]}
function getAllEmptyCells(){return[...cells].filter(cell=>!cell.classList.contains('x')&&!cell.classList.contains('o'))}
function getCenterCells(){const centerCells=[];for(let row=4;row<=6;row++){for(let col=4;col<=6;col++){const index=row*10+col;const cell=cells[index];if(!cell.classList.contains('x')&&!cell.classList.contains('o')){centerCells.push(cell)}}}
return centerCells}
function showThinkingIndicator(){thinkingIndicator.classList.add('show')}
function hideThinkingIndicator(){thinkingIndicator.classList.remove('show')}
function getRandomThinkingTime(){const times=[500,1000,1500,2000,2500,3000];return times[Math.floor(Math.random()*times.length)]}
function evaluatePosition(index,currentClass){const row=Math.floor(index/10);const col=index%10;let score=0;const directions=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];for(const[dx,dy]of directions){let count=0;let blocked=0;let space=0;for(let step=1;step<=4;step++){const newRow=row+dx*step;const newCol=col+dy*step;if(newRow<0||newRow>=10||newCol<0||newCol>=10){blocked++;break}
const cell=cells[newRow*10+newCol];if(cell.classList.contains(currentClass)){count++}else if(!cell.classList.contains('x')&&!cell.classList.contains('o')){space++}else{blocked++;break}}
if(count===3&&space===1&&blocked===0)score+=1000;else if(count===2&&space===2&&blocked===0)score+=100;else if(count===1&&space===3&&blocked===0)score+=10}
if((row===4||row===5)&&(col===4||col===5))score+=5;if(row>=2&&row<=7&&col>=2&&col<=7)score+=2;return score}
function findBestMove(){const emptyCells=getAllEmptyCells();let bestScore=-1;let bestCell=null;const winningMove=checkFourInARow('x');if(winningMove)return winningMove;const blockingMove=checkFourInARow('o');if(blockingMove)return blockingMove;if(computerDifficulty==='5'&&Math.random()<0.6){return getRandomCell(emptyCells)}
for(const cell of emptyCells){const index=parseInt(cell.dataset.index);let attackScore=evaluatePosition(index,'x');let defenseScore=evaluatePosition(index,'o');let totalScore;if(computerDifficulty==='5'){totalScore=attackScore*0.7+defenseScore*1.3;if(isStrategicPosition(index)){totalScore*=1.1}}else if(computerDifficulty==='8'){totalScore=attackScore*1.0+defenseScore*1.2;if(isStrategicPosition(index)){totalScore*=1.2}}else if(computerDifficulty==='20'){totalScore=attackScore*1.3+defenseScore*1.4;if(canCreateDoubleThreat(index,'x')){totalScore*=1.8}
if(canCreateDoubleThreat(index,'o')){totalScore*=1.6}
if(isStrategicPosition(index)){totalScore*=1.4}}else if(computerDifficulty==='24'){totalScore=attackScore*1.8+defenseScore*1.6;if(canCreateDoubleThreat(index,'x')){totalScore*=2.2}
if(canCreateDoubleThreat(index,'o')){totalScore*=2.0}
if(isStrategicPosition(index)){totalScore*=2.0}}else if(computerDifficulty==='36'){totalScore=attackScore*8.0+defenseScore*5.0;if(canCreateTripleThreat(index,'x')){totalScore*=12.0}
if(canCreateTripleThreat(index,'o')){totalScore*=10.0}
if(canCreateDoubleThreat(index,'x')){totalScore*=7.0}
if(canCreateDoubleThreat(index,'o')){totalScore*=6.0}
if(isStrategicPosition(index)){totalScore*=3.5}
if(canCreateDoubleThreat(index,'x')&&canCreateTripleThreat(index,'x')){totalScore*=15.0}
if(canCreateFork(index,'x')){totalScore*=8.0}
if(canCreateFork(index,'o')){totalScore*=7.5}
if(emptyCells.length>80){if(isStrategicPosition(index)){totalScore*=2.0}}
if(emptyCells.length<40){totalScore*=1.5}
if(lastHumanMove){const lastMoveIndex=parseInt(lastHumanMove.dataset.index);const distance=Math.abs(index-lastMoveIndex);if(distance<=20){totalScore*=1.3}}}
if(totalScore>bestScore){bestScore=totalScore;bestCell=cell}}
if(!bestCell||bestScore===0){const centerCells=getCenterCells();if(centerCells.length>0){return getRandomCell(centerCells)}
return getRandomCell(emptyCells)}
return bestCell}
function canCreateDoubleThreat(index,symbol){const row=Math.floor(index/10);const col=index%10;let threatCount=0;const directions=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];for(const[dx,dy]of directions){let count=0;let space=0;let blocked=0;for(let step=1;step<=4;step++){const newRow=row+dx*step;const newCol=col+dy*step;if(newRow<0||newRow>=10||newCol<0||newCol>=10){blocked++;break}
const cell=cells[newRow*10+newCol];if(cell.classList.contains(symbol)){count++}else if(!cell.classList.contains('x')&&!cell.classList.contains('o')){space++}else{blocked++;break}}
if(count>=2&&space>=2&&blocked===0){threatCount++}}
return threatCount>=2}
function isStrategicPosition(index){const row=Math.floor(index/10);const col=index%10;if(row>=3&&row<=6&&col>=3&&col<=6){return!0}
let openDirections=0;const directions=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];for(const[dx,dy]of directions){let hasSpace=!0;for(let step=1;step<=4;step++){const newRow=row+dx*step;const newCol=col+dy*step;if(newRow<0||newRow>=10||newCol<0||newCol>=10){hasSpace=!1;break}}
if(hasSpace)openDirections++}
return openDirections>=4}
function canCreateTripleThreat(index,symbol){const row=Math.floor(index/10);const col=index%10;let threatCount=0;const directions=[[-1,-1],[-1,0],[-1,1],[0,-1],[0,1],[1,-1],[1,0],[1,1]];for(const[dx,dy]of directions){let count=0;let space=0;let blocked=0;for(let step=1;step<=4;step++){const newRow=row+dx*step;const newCol=col+dy*step;if(newRow<0||newRow>=10||newCol<0||newCol>=10){blocked++;break}
const cell=cells[newRow*10+newCol];if(cell.classList.contains(symbol)){count++}else if(!cell.classList.contains('x')&&!cell.classList.contains('o')){space++}else{blocked++;break}}
if(count>=3&&space>=1&&blocked===0){threatCount++}}
return threatCount>=3}
function canCreateFork(index,symbol){const row=Math.floor(index/10);const col=index%10;let winningDirections=0;const directions=[[0,1],[1,0],[1,1],[1,-1]];for(const[dx,dy]of directions){let canWinThisDirection=!0;let symbolCount=0;for(let i=-4;i<=4;i++){const newRow=row+dx*i;const newCol=col+dy*i;if(newRow>=0&&newRow<10&&newCol>=0&&newCol<10){const cell=cells[newRow*10+newCol];if(cell.classList.contains(symbol)){symbolCount++}else if(cell.classList.contains(symbol==='x'?'o':'x')){if(Math.abs(i)<=2){canWinThisDirection=!1;break}}}}
if(canWinThisDirection&&symbolCount>=2){winningDirections++}}
return winningDirections>=2}
function evaluateThreatLevel(index,symbol){let threatLevel=0;if(canCreateTripleThreat(index,symbol))threatLevel+=1000;if(canCreateDoubleThreat(index,symbol))threatLevel+=500;if(canCreateFork(index,symbol))threatLevel+=300;if(isStrategicPosition(index))threatLevel+=100;return threatLevel}
function preloadSounds(){setupAudio(winSounds);setupAudio(loseAudios);setupAudio(moveSounds)}
function updateSoundArrays(isEnabled){isSoundEnabled=isEnabled;const allSounds=[...winSounds,...loseAudios,...moveSounds];allSounds.forEach(sound=>{sound.volume=isEnabled?0.5:0})}
function computerPlay(){if(!gameActive||!isComputerMode||!isPlayer1Turn)return;const emptyCells=getAllEmptyCells();const isFirstMove=emptyCells.length===100;if(!isFirstMove){showThinkingIndicator()}
setTimeout(()=>{if(!isFirstMove){hideThinkingIndicator()}
let cellToPlay;if(isFirstMove){const centerCells=getCenterCells();cellToPlay=getRandomCell(centerCells)}else{cellToPlay=findBestMove()}
if(cellToPlay){const willWin=checkWinningMove(cellToPlay,'x');if(!willWin){playMoveSound()}
handleCellClick(cellToPlay)}},isFirstMove?0:getRandomThinkingTime())}
function checkWinningMove(cell,symbol){const originalClass=cell.className;cell.classList.add(symbol);const isWinning=checkWin(symbol);cell.className=originalClass;return isWinning}
function savePlayerInfo(playerNumber,name,avatar){if(!isComputerMode||playerNumber===2){localStorage.setItem(`player${playerNumber}Name`,name);localStorage.setItem(`player${playerNumber}Avatar`,avatar)}}
function loadPlayerInfo(){if(!isComputerMode){const savedName1=localStorage.getItem('player1Name');const savedAvatar1=localStorage.getItem('player1Avatar');if(savedName1)player1NameInput.value=savedName1;if(savedAvatar1){document.querySelector('.player-1 .current-avatar').className=`current-avatar fa-solid ${savedAvatar1} fa-6x`}}
const savedName2=localStorage.getItem('player2Name');const savedAvatar2=localStorage.getItem('player2Avatar');if(savedName2)player2NameInput.value=savedName2;if(savedAvatar2){document.querySelector('.player-2 .current-avatar').className=`current-avatar fa-solid ${savedAvatar2} fa-6x`}
updateGameAreaAvatars()}
document.addEventListener('DOMContentLoaded',()=>{initializeBoard();preloadSounds();updateGameAreaAvatars()});function getComputerInfoByDifficulty(difficulty){let computerInfo={avatar:'fa-cat',name:"B√© M√®o Con"};switch(difficulty){case '5':computerInfo={avatar:'fa-cat',name:"B√© M√®o Con"};break;case '8':computerInfo={avatar:'fa-dog',name:"Anh C√∫n Con"};break;case '20':computerInfo={avatar:'fa-otter',name:"Ch√∫ L∆∞·ªùi L√©m"};break;case '24':computerInfo={avatar:'fa-hippo',name:"B√°c H√† M√£"};break;case '36':computerInfo={avatar:'fa-dragon',name:"Cao th·ªß R·ªìng"};break}
return computerInfo}
function initializeBoard(){for(let i=0;i<100;i++){const cell=document.createElement('div');cell.classList.add('cell');cell.setAttribute('data-index',i);board.appendChild(cell)}
cells=document.querySelectorAll('.cell');const difficultySelect=document.getElementById('difficulty');const soundToggle=document.getElementById('sound-toggle');const savedDifficulty=localStorage.getItem('computerDifficulty')||'5';computerDifficulty=savedDifficulty;difficultySelect.value=savedDifficulty;const computerInfo=getComputerInfoByDifficulty(savedDifficulty);if(isComputerMode){document.querySelector('.player-1 .current-avatar').className=`current-avatar fa-solid ${computerInfo.avatar} fa-6x`;player1NameInput.value=computerInfo.name;Array.from(difficultySelect.options).forEach(option=>{const optionInfo=getComputerInfoByDifficulty(option.value);option.textContent=optionInfo.name})}
difficultySelect.addEventListener('change',function(){computerDifficulty=this.value;localStorage.setItem('computerDifficulty',this.value);if(isComputerMode){const computerInfo=getComputerInfoByDifficulty(this.value);document.querySelector('.player-1 .current-avatar').className=`current-avatar fa-solid ${computerInfo.avatar} fa-6x`;player1NameInput.value=computerInfo.name;updateGameAreaAvatars();const difficultyOptions=document.getElementById('difficulty').options;for(let option of difficultyOptions){const optionInfo=getComputerInfoByDifficulty(option.value);option.textContent=optionInfo.name}
updateTurnInfo()}});soundToggle.addEventListener('click',function(){this.classList.toggle('active');const isEnabled=this.classList.contains('active');localStorage.setItem('isSoundEnabled',isEnabled);updateSoundArrays(isEnabled)});if(isSoundEnabled){soundToggle.classList.add('active')}
loadPlayerInfo()}
function setupAudio(audioArray){audioArray.forEach(audio=>{audio.preload='auto';audio.volume=0.5})}
function playAudioSafely(audio){if(!isSoundEnabled)return;audio.currentTime=0;const playPromise=audio.play();if(playPromise!==undefined){playPromise.catch(error=>{console.log("Playback prevented:",error)})}}
function playWinSound(){if(!isSoundEnabled)return;const randomSound=winSounds[Math.floor(Math.random()*winSounds.length)];playAudioSafely(randomSound)}
function playLoseSound(){if(!isSoundEnabled)return;const randomSound=loseAudios[Math.floor(Math.random()*loseAudios.length)];playAudioSafely(randomSound)}
function playMoveSound(){if(!gameActive||!isSoundEnabled)return;const randomSound=moveSounds[Math.floor(Math.random()*moveSounds.length)];playAudioSafely(randomSound)}
function updateGameAreaAvatars(){const gameArea=document.querySelector('.game-area');const player1Avatar=document.querySelector('.player-1 .current-avatar').className.split(' ')[2];const player2Avatar=document.querySelector('.player-2 .current-avatar').className.split(' ')[2];const oldClasses=Array.from(gameArea.classList).filter(c=>c.startsWith('fa-'));oldClasses.forEach(c=>gameArea.classList.remove(c));if(player1Avatar){gameArea.classList.add(player1Avatar)}
if(player2Avatar){gameArea.classList.add(player2Avatar+'-2')}}
function updatePlayerName(player,newName){if(player===1){player1Name=newName;document.querySelector('.player1-avatar .player-name').textContent=newName;const difficultySelect=document.getElementById('difficulty-select');Array.from(difficultySelect.options).forEach(option=>{if(option.value.includes('D·ªÖ')){option.text=`${newName} (D·ªÖ)`}else if(option.value.includes('V·ª´a')){option.text=`${newName} (V·ª´a)`}else if(option.value.includes('Kh√≥')){option.text=`${newName} (Kh√≥)`}});localStorage.setItem(STORAGE_KEYS.PLAYER1_NAME,newName)}else{player2Name=newName;document.querySelector('.player2-avatar .player-name').textContent=newName;localStorage.setItem(STORAGE_KEYS.PLAYER2_NAME,newName)}
updateTurnInfo()}
function initializeScoreLabels(){document.getElementById('score-label-1').textContent=player1Name;document.getElementById('score-label-2').textContent=player2Name}
function initGame(){const savedPlayer1Name=localStorage.getItem(STORAGE_KEYS.PLAYER1_NAME);const savedPlayer2Name=localStorage.getItem(STORAGE_KEYS.PLAYER2_NAME);if(savedPlayer1Name){updatePlayerName(1,savedPlayer1Name)}
if(savedPlayer2Name){updatePlayerName(2,savedPlayer2Name)}
const difficultySelect=document.getElementById('difficulty-select');const savedDifficulty=localStorage.getItem(STORAGE_KEYS.DIFFICULTY);if(savedDifficulty){difficultySelect.value=savedDifficulty}
Array.from(difficultySelect.options).forEach(option=>{if(option.value.includes('D·ªÖ')){option.text=`${player1Name} (D·ªÖ)`}else if(option.value.includes('V·ª´a')){option.text=`${player1Name} (V·ª´a)`}else if(option.value.includes('Kh√≥')){option.text=`${player1Name} (Kh√≥)`}});difficultySelect.addEventListener('change',function(){localStorage.setItem(STORAGE_KEYS.DIFFICULTY,this.value)});const voiceButton=document.getElementById('voice-button');voiceButton.style.display=isComputerMode?'block':'none';resetGame()}
function toggleGameMode(){isComputerMode=!isComputerMode;const difficultySelect=document.getElementById('difficulty-select');const voiceButton=document.getElementById('voice-button');if(isComputerMode){difficultySelect.style.display='block';voiceButton.style.display='block'}else{difficultySelect.style.display='none';voiceButton.style.display='none'}
resetGame()}